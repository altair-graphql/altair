<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pre and post request scripts | Altair GraphQL Client</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM+Sans:400,500,700&amp;display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <meta name="description" content="A beautiful feature-rich GraphQL Client IDE for all platforms. Enables you interact with any GraphQL server you are authorized to access from any platform you are on. Much like Postman for GraphQL, you can easily test and optimize your GraphQL implementations.">
    <meta property="article:modified_time" content="2022-08-24T20:50:28.000Z">
    <meta property="og:site_name" content="Altair GraphQL Client">
    <meta property="og:title" content="Pre and post request scripts">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/docs/features/prerequest-scripts.html">
    <meta name="twitter:title" content="Pre and post request scripts">
    <meta name="twitter:url" content="/docs/features/prerequest-scripts.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta itemprop="name" content="Altair GraphQL Client">
    <meta itemprop="description" content="A beautiful feature-rich GraphQL Client IDE for all platforms. Enables you interact with any GraphQL server you are authorized to access from any platform you are on. Much like Postman for GraphQL, you can easily test and optimize your GraphQL implementations.">
    <meta itemprop="image" content="/assets/img/app-shot.png">
    <meta name="author" content="Samuel Imolorhe">
    <meta property="og:description" content="A beautiful feature-rich GraphQL Client IDE for all platforms. Enables you interact with any GraphQL server you are authorized to access from any platform you are on. Much like Postman for GraphQL, you can easily test and optimize your GraphQL implementations.">
    <meta property="og:image" content="/assets/img/app-shot.png">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Altair GraphQL Client">
    <meta property="twitter:description" content="A beautiful feature-rich GraphQL Client IDE for all platforms. Enables you interact with any GraphQL server you are authorized to access from any platform you are on. Much like Postman for GraphQL, you can easily test and optimize your GraphQL implementations.">
    <meta property="twitter:image" content="/assets/img/app-shot.png">
    
    <link rel="preload" href="/assets/css/0.styles.a891e3db.css" as="style"><link rel="preload" href="/assets/js/app.3cc60053.js" as="script"><link rel="preload" href="/assets/js/2.d41941e6.js" as="script"><link rel="preload" href="/assets/js/24.5106e9aa.js" as="script"><link rel="prefetch" href="/assets/js/10.39ff0b27.js"><link rel="prefetch" href="/assets/js/11.5b38140c.js"><link rel="prefetch" href="/assets/js/12.c3cbc8e5.js"><link rel="prefetch" href="/assets/js/13.f2ea77af.js"><link rel="prefetch" href="/assets/js/14.09eff982.js"><link rel="prefetch" href="/assets/js/15.b11ed04c.js"><link rel="prefetch" href="/assets/js/16.f33c53f7.js"><link rel="prefetch" href="/assets/js/17.218c82c1.js"><link rel="prefetch" href="/assets/js/18.c2c2447d.js"><link rel="prefetch" href="/assets/js/19.115ba30e.js"><link rel="prefetch" href="/assets/js/20.63850373.js"><link rel="prefetch" href="/assets/js/21.69e01f68.js"><link rel="prefetch" href="/assets/js/22.e2199d98.js"><link rel="prefetch" href="/assets/js/23.35b7def5.js"><link rel="prefetch" href="/assets/js/25.ffefd209.js"><link rel="prefetch" href="/assets/js/26.cceed843.js"><link rel="prefetch" href="/assets/js/27.5941f17a.js"><link rel="prefetch" href="/assets/js/28.4d4dd744.js"><link rel="prefetch" href="/assets/js/29.20d2bb6e.js"><link rel="prefetch" href="/assets/js/3.6452a39a.js"><link rel="prefetch" href="/assets/js/30.5f728be9.js"><link rel="prefetch" href="/assets/js/31.820cd142.js"><link rel="prefetch" href="/assets/js/32.f288e6f1.js"><link rel="prefetch" href="/assets/js/33.7aaa3c51.js"><link rel="prefetch" href="/assets/js/34.3d64c0b1.js"><link rel="prefetch" href="/assets/js/35.082a1d39.js"><link rel="prefetch" href="/assets/js/36.4d657b69.js"><link rel="prefetch" href="/assets/js/37.a2aff75c.js"><link rel="prefetch" href="/assets/js/38.7387a9bf.js"><link rel="prefetch" href="/assets/js/39.e671973b.js"><link rel="prefetch" href="/assets/js/4.e7623dca.js"><link rel="prefetch" href="/assets/js/40.3430783d.js"><link rel="prefetch" href="/assets/js/41.7636cfb2.js"><link rel="prefetch" href="/assets/js/42.50366f5f.js"><link rel="prefetch" href="/assets/js/43.56b0dc64.js"><link rel="prefetch" href="/assets/js/5.6b73a8d9.js"><link rel="prefetch" href="/assets/js/6.ae1a9d24.js"><link rel="prefetch" href="/assets/js/7.fa77f510.js"><link rel="prefetch" href="/assets/js/8.617042e8.js"><link rel="prefetch" href="/assets/js/9.37e7398f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a891e3db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Altair GraphQL Client</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="https://twitter.com/AltairGraphQL" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://opencollective.com/altair/donate" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/altair-graphql/altair" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="https://twitter.com/AltairGraphQL" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://opencollective.com/altair/donate" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/altair-graphql/altair" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/docs/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><a href="/docs/contributing.html" class="sidebar-link">Contributing</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Features</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/features/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/docs/features/add-queries-and-fragments.html" class="sidebar-link">One-click Query Generation</a></li><li><a href="/docs/features/autofill-fields-at-cursor.html" class="sidebar-link">Autofill all fields at cursor</a></li><li><a href="/docs/features/collections.html" class="sidebar-link">Collections</a></li><li><a href="/docs/features/documentation.html" class="sidebar-link">GraphQL Docs (via introspection)</a></li><li><a href="/docs/features/editor-capabilities.html" class="sidebar-link">Editor capabilities</a></li><li><a href="/docs/features/environment-variables.html" class="sidebar-link">Environment Variables</a></li><li><a href="/docs/features/file-upload.html" class="sidebar-link">Variables and File Upload</a></li><li><a href="/docs/features/graphql-subscriptions.html" class="sidebar-link">GraphQL Subscriptions (with desktop notifications)</a></li><li><a href="/docs/features/headers.html" class="sidebar-link">Headers and Response Stats</a></li><li><a href="/docs/features/import-export-queries.html" class="sidebar-link">Import and Export Queries</a></li><li><a href="/docs/features/multiple-languages.html" class="sidebar-link">Multiple Languages</a></li><li><a href="/docs/features/multiple-platforms.html" class="sidebar-link">Multiple Platforms</a></li><li><a href="/docs/features/multiple-windows.html" class="sidebar-link">Multiple Windows</a></li><li><a href="/docs/features/prerequest-scripts.html" aria-current="page" class="active sidebar-link">Pre and post request scripts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/features/prerequest-scripts.html#execution-order" class="sidebar-link">Execution order</a></li><li class="sidebar-sub-header"><a href="/docs/features/prerequest-scripts.html#example-use-cases" class="sidebar-link">Example Use Cases</a></li></ul></li><li><a href="/docs/features/query-history.html" class="sidebar-link">History of recent queries</a></li><li><a href="/docs/features/schema-auto-refresh.html" class="sidebar-link">Schema auto refresh</a></li><li><a href="/docs/features/settings-pane.html" class="sidebar-link">Settings Pane</a></li><li><a href="/docs/features/syntax-highlighting.html" class="sidebar-link">Syntax and Error Highlighting</a></li><li><a href="/docs/features/theme-customization.html" class="sidebar-link">Multiple Themes</a></li><li><a href="/docs/features/variables.html" class="sidebar-link">Variables and Fragments</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integrations</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Plugins</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Support</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tips</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="carbon-ads"></div></aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pre-and-post-request-scripts"><a href="#pre-and-post-request-scripts" class="header-anchor">#</a> Pre and post request scripts</h1> <p>Ever wanted to use dynamic data in your request headers, URLs, before sending the request? Pre request scripts enables you do that. With pre request scripts, you can set environment variables from your cookies or create any combination of values for your environment variables. This comes in handy for environments where things like CSRF tokens are used to verify the requests sent to the server.</p> <p>You might want to perform some extra logic with the response from a request. For example, setting an environment variable from a response header, or from the result of a query. Post request scripts enables you do just that.</p> <h2 id="execution-order"><a href="#execution-order" class="header-anchor">#</a> Execution order</h2> <p>Pre and post request scripts can be added to a query window, as well as to a <a href="/docs/features/collections">collection</a>.
Also collections can be nested with sub collections as well. When a query that belongs to a collection is executed, the pre and post request scripts of the query window is executed as well as all the pre and post request scripts of the query's collection and all its parent collections. The execution order is as follows:</p> <ul><li>Query collection pre request script</li> <li>All parent collections' pre request scripts</li> <li>Query window pre request script</li> <li>Execute query request</li> <li>Query collection post request script</li> <li>All parent collections' post request scripts</li> <li>Query window post request script</li></ul> <p><img src="/assets/img/docs/request-script-execution-order.png" alt="Request script execution order"></p> <h3 id="available-api-for-request-scripts"><a href="#available-api-for-request-scripts" class="header-anchor">#</a> Available API for request scripts</h3> <p>Request scripts support all JavaScript syntax supported in the latest <a href="https://tc39.es/ecma262/" target="_blank" rel="noopener noreferrer">ecmascript 2019 (ES10) specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (except <strong>with</strong> and <strong>label</strong> statements, but those are discouraged anyway). These include things like <code>[].flat()</code>, <code>[].flatMap()</code>, <code>Object.fromEntries()</code>, etc.</p> <p>There is also a global object <code>altair</code> available within the context of the request script containing helper methods for interacting with altair.</p> <h3 id="altair-data"><a href="#altair-data" class="header-anchor">#</a> altair.data</h3> <p>This contains data used to process your GraphQL request.</p> <p><strong>altair.data.headers</strong> - The headers sent as part of your request.</p> <p><strong>altair.data.variables</strong> - The parsed variables object sent as part of your request.</p> <p><strong>altair.data.query</strong> - The GraphQL query sent to the server.</p> <p><strong>altair.data.environment</strong> - The formatted environment object containing the serialized set of environment data before your request is sent.</p> <h3 id="altair-helpers"><a href="#altair-helpers" class="header-anchor">#</a> altair.helpers</h3> <p>This contains a number of helper methods for carrying out basic tasks, like interacting with altair, making network requests, etc.</p> <p><strong>altair.helpers.getEnvironment(key: string)</strong> - Returns the environment variable for the specified key.</p> <div class="language-js extra-class"><pre class="language-js"><code>altair<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token string">'api_key'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>altair.helpers.setEnvironment(key: string, val: any, activeEnvironment?: boolean)</strong> - Sets the environment variable for the specified key, overriding the environment variable for the current request. You can also pass an extra boolean parameter to indicate if the environment variable should also be set in the currently active environment.</p> <div class="language-js extra-class"><pre class="language-js"><code>altair<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token string">'api_key'</span><span class="token punctuation">,</span> <span class="token string">'a482djksd289xxxxxxxxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>altair.helpers.getCookie(key: string)</strong> - Retrieves a value stored in browser cookie.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sessid <span class="token operator">=</span> altair<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">'sessid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>altair.helpers.request(...args)</strong> - <em>[Returns a promise]</em> Makes a HTTP request using the provided options. This helper simply passes on the arguments to the <a href="https://angular.io/guide/http#httpclient" target="_blank" rel="noopener noreferrer">HttpClient<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in angular. To know all the possible options, checkout the <a href="https://angular.io/api/common/http/HttpClient#request" target="_blank" rel="noopener noreferrer">Angular HttpClient API documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> altair<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://api.agify.io/?name=michael'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// res =&gt; {&quot;name&quot;:&quot;michael&quot;,&quot;age&quot;:60,&quot;count&quot;:41938}</span>
</code></pre></div><h2 id="example-use-cases"><a href="#example-use-cases" class="header-anchor">#</a> Example Use Cases</h2> <h3 id="persisting-data-between-requests"><a href="#persisting-data-between-requests" class="header-anchor">#</a> Persisting data between requests</h3> <p>Since altair pretty much lives in a browser environment, it does support the <code>LocalStorage</code> feature. This is useful when you need an authentication token before each request but only requesting the token when your authentication expired.</p> <p>Assuming you have this header in the <code>Set Headers window</code>:</p> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td>Authorization</td> <td><code>Bearer </code></td></tr></tbody></table> <p>Below is a working example of pre-request script for persisting data between requests (token, token_expiry):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">nowInSeconds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tokenExpiry <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;token_expiry&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">nowInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">Number</span><span class="token punctuation">(</span>tokenExpiry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// If the token expiry time has passed, fetch a new token from your auth server again (take note of the await)</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> altair<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'https://auth.example.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* auth payload */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// res =&gt; { &quot;token&quot;: &quot;abcd&quot;, &quot;expiry&quot;: 3600 }</span>
  
  <span class="token comment">// Store the received token and expiry in localStorage</span>
  <span class="token comment">// Alternatively you can set this in the active environment</span>
  <span class="token comment">// altair.helpers.setEnvironment(&quot;token&quot;, res.token);</span>
  <span class="token comment">// altair.helpers.setEnvironment(&quot;token_expiry&quot;, nowInSeconds() + res.expiry);</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;token_expiry&quot;</span><span class="token punctuation">,</span> <span class="token function">nowInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>expiry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Retrieve the token from localStorage</span>
<span class="token comment">// const token = altair.helpers.getEnvironment(&quot;token&quot;);</span>
<span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the token as the `token_env` environment variable in Altair</span>
altair<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token string">'token_env'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// You can use the environment variables in Altair after setting it by following this blog post: https://sirmuel.design/altair-becomes-environment-friendly-%EF%B8%8F-f9b4e9ef887c</span>
</code></pre></div><h3 id="altair-response-available-in-post-request-script"><a href="#altair-response-available-in-post-request-script" class="header-anchor">#</a> altair.response (Available in post request script)</h3> <p>This contains response from your GraphQL request. <strong>Note: This is only available in post request scripts.</strong></p> <p><strong>altair.response.headers</strong> - The response headers sent from the server. <strong>Note: Due to some limitations on response headers in the browser, it is advisable to use the desktop apps if you need to use the response headers</strong></p> <p><strong>altair.response.statusCode</strong> - The status code of the response.</p> <p><strong>altair.response.requestType</strong> - Indicates the type of request being sent. Values are <code>query</code>, <code>introspection</code> or <code>subscription</code>.</p> <p><strong>altair.response.responseTime</strong> - The total time of the request</p> <p><strong>altair.response.body</strong> - The response body</p> <h3 id="altair-importmodule"><a href="#altair-importmodule" class="header-anchor">#</a> altair.importModule</h3> <p>This allows you to import some modules that are made available in the pre request script editor. It <em>returns a promise</em> that resolves with the imported module.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btoa <span class="token operator">=</span> <span class="token keyword">await</span> altair<span class="token punctuation">.</span><span class="token function">importModule</span><span class="token punctuation">(</span><span class="token string">'btoa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token string">'username:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The available modules are:</p> <ul><li><a href="https://www.npmjs.com/package/abab" target="_blank" rel="noopener noreferrer">atob<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.npmjs.com/package/abab" target="_blank" rel="noopener noreferrer">btoa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.npmjs.com/package/crypto-js" target="_blank" rel="noopener noreferrer">crypto-js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/altair-graphql/altair/edit/master/site/src/docs/features/prerequest-scripts.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/24/2022, 8:50:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/features/multiple-windows.html" class="prev">
        Multiple Windows
      </a></span> <span class="next"><a href="/docs/features/query-history.html">
        History of recent queries
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3cc60053.js" defer></script><script src="/assets/js/2.d41941e6.js" defer></script><script src="/assets/js/24.5106e9aa.js" defer></script>
  </body>
</html>
